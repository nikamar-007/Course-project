<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω ‚Äî –†–µ–º–æ–Ω—Ç–Ω—ã–µ –∑–æ–Ω—ã</title>
  <link rel="stylesheet" href="/style.css">
  <script src="js/init-landing.js" defer></script>
  <style>
    body {
      background: var(--bg-primary);
      min-height: 100vh;
      overflow: hidden;
    }
    .zones-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
    }
    
    .stat-card.pending {
      border-left: 4px solid #9E9E9E;
    }
    
    .stat-card.active-red {
      border-left: 4px solid #E53935;
    }
    
    .stat-card.active-yellow {
      border-left: 4px solid #FBC02D;
    }
    
    .stat-card.expired-green {
      border-left: 4px solid #43A047;
    }
    
    .stat-card.total {
      border-left: 4px solid #2196F3;
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .stat-label {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-details {
      font-size: 12px;
      color: #888;
      margin-top: 5px;
    }
    
    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 100px 20px 40px;
      min-height: calc(100vh - 70px);
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      position: sticky;
      top: 0;
      background: #f5f7fa;
      z-index: 10;
      padding-top: 20px;
      padding-bottom: 15px;
    }
    
    .admin-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .admin-table th {
      background: #F7FAFC;
      padding: 16px 20px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      color: #4A5568;
      border-bottom: 1px solid #E2E8F0;
      position: sticky;
      top: 0;
      z-index: 5;
    }
    
    .admin-table td {
      padding: 20px;
      border-bottom: 1px solid #E2E8F0;
      font-size: 15px;
      color: #2D3748;
    }
    
    .admin-table tr:hover {
      background: #F7FAFC;
    }
    
    .table-actions {
      display: flex;
      gap: 8px;
    }
    
    .btn-view {
      background: #EDF2F7;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: #2D3748;
      transition: all 0.2s;
    }
    
    .btn-view:hover {
      background: #E2E8F0;
    }
    
    .btn-delete {
      background: #FED7D7;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: #C53030;
      transition: all 0.2s;
    }
    
    .btn-delete:hover {
      background: #FEB2B2;
    }
    
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      display: inline-block;
    }
    
    .status-pending {
      background: #9E9E9E33;
      color: #424242;
      border: 1px solid #9E9E9E;
    }
    
    .status-active-red {
      background: #E5393533;
      color: #B71C1C;
      border: 1px solid #E53935;
    }
    
    .status-active-yellow {
      background: #FBC02D33;
      color: #F57F17;
      border: 1px solid #FBC02D;
    }
    
    .status-expired-green {
      background: #43A04733;
      color: #1B5E20;
      border: 1px solid #43A047;
    }
    
    .status-deleted {
      background: #FED7D7;
      color: #742A2A;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #718096;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #A0AEC0;
    }

    .filters {
    background: white;
    padding: 15px 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    gap: 15px;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.filter-btn {
    padding: 8px 16px;
    border-radius: 20px;
    border: 1px solid #E2E8F0;
    background: white;
    color: #4A5568;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
}

.filter-btn:hover {
    background: #F7FAFC;
}

.filter-btn.active {
    background: #E53935;
    color: white;
    border-color: #E53935;
}
  </style>
</head>
<body>
<div id="adminHeader"></div>

<script>
fetch('header-admin.html')
  .then(r => r.text())
  .then(html => {
    document.getElementById('adminHeader').innerHTML = html;
    initAdminHeader('zones');
  });

document.querySelector('.logo').addEventListener('click', function(e) {
    e.preventDefault();
    if (typeof showLandingCard === 'function') {
        showLandingCard();
    }
});
</script>

<div class="admin-container">
  <div class="zones-stats" id="zonesStats">
    <div class="stat-card total" onclick="filterZones('all')">
        <div class="stat-number" id="totalZones">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ –∑–æ–Ω</div>
        <div class="stat-details">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ</div>
    </div>
    <div class="stat-card pending" onclick="filterZones('pending')">
        <div class="stat-number" id="pendingZones">0</div>
        <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (—Å–µ—Ä—ã–µ)</div>
        <div class="stat-details">0 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π, —Å–æ–∑–¥–∞–Ω—ã –º–µ–Ω–µ–µ 24 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥</div>
    </div>
    <div class="stat-card active-red" onclick="filterZones('active-red')">
        <div class="stat-number" id="activeRedZones">0</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ</div>
        <div class="stat-details">‚â•1 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω—ã ‚â§7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥</div>
    </div>
    <div class="stat-card active-yellow" onclick="filterZones('active-yellow')">
        <div class="stat-number" id="activeYellowZones">0</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –∂–µ–ª—Ç—ã–µ</div>
        <div class="stat-details">‚â•1 –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω—ã 7-14 –¥–Ω–µ–π –Ω–∞–∑–∞–¥</div>
    </div>
    <div class="stat-card expired-green" onclick="filterZones('expired-green')">
        <div class="stat-number" id="expiredGreenZones">0</div>
        <div class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–µ–ª–µ–Ω—ã–µ</div>
        <div class="stat-details">>14 –¥–Ω–µ–π, —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π</div>
    </div>
  </div>
  <div class="filters">
      <span style="font-weight: 500; color: #4A5568;">–§–∏–ª—å—Ç—Ä—ã:</span>
      <button class="filter-btn active" onclick="filterZones('all')">–í—Å–µ</button>
      <button class="filter-btn" onclick="filterZones('pending')">–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</button>
      <button class="filter-btn" onclick="filterZones('active-red')">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ</button>
      <button class="filter-btn" onclick="filterZones('active-yellow')">–ê–∫—Ç–∏–≤–Ω—ã–µ –∂–µ–ª—Ç—ã–µ</button>
      <button class="filter-btn" onclick="filterZones('expired-green')">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–µ–ª–µ–Ω—ã–µ</button>
      <button class="filter-btn" onclick="filterZones('deleted')">–£–¥–∞–ª–µ–Ω–Ω—ã–µ</button>
  </div>
  <div class="admin-table-wrapper">
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–°–æ–∑–¥–∞—Ç–µ–ª—å</th>
          <th>–°–æ–∑–¥–∞–Ω–∞</th>
          <th>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π</th>
          <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody id="zones">
        <tr>
          <td colspan="8" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–æ–Ω...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
function initAdminHeader(activeAdminPage) {
  fetch('/api/me.php')
    .then(r => {
      if (!r.ok) throw new Error();
      return r.json();
    })
    .then(user => {
      const greeting = getGreeting();
      
      const navHTML = `
        <span class="greeting">${greeting}, ${user.nickname || user.email}</span>
        
        <a href="/index.html" class="nav-link">–ö–∞—Ä—Ç–∞</a>
        
        <a href="/notifications.html" class="nav-link">
          –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
          ${user.unread_notifications > 0 ? `
            <span class="notif-badge">${user.unread_notifications}</span>
          ` : ''}
        </a>
        
        <a href="/feedback.html" class="nav-link">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
        
        <a href="/profile.html" class="nav-link">–ü—Ä–æ—Ñ–∏–ª—å</a>

        <div class="admin-dropdown">
          <button class="admin-dropbtn">
            –ê–¥–º–∏–Ω
            <span class="admin-badge">‚öôÔ∏è</span>
          </button>
          <div class="admin-dropdown-content">
            <a href="/admin/zones.html" class="${activeAdminPage === 'zones' ? 'active' : ''}">–ó–æ–Ω—ã —Ä–µ–º–æ–Ω—Ç–∞</a>
            <a href="/admin/users.html" class="${activeAdminPage === 'users' ? 'active' : ''}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            <a href="/admin/feedback.html" class="${activeAdminPage === 'feedback' ? 'active' : ''}">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
            <a href="/admin/broadcast.html" class="${activeAdminPage === 'broadcast' ? 'active' : ''}">–†–∞—Å—Å—ã–ª–∫–∞</a>
          </div>
        </div>
        
        <a href="/api/logout.php" class="nav-link">–í—ã—Ö–æ–¥</a>
      `;
      
      document.getElementById('nav').innerHTML = navHTML;
    })
    .catch(() => {
      window.location.href = '/login.html';
    });
}

function getGreeting() {
  const hour = new Date().getHours();
  if (hour >= 5 && hour < 12) return '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
  if (hour >= 12 && hour < 17) return '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
  if (hour >= 17 && hour < 23) return '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
  return '–î–æ–±—Ä–æ–π –Ω–æ—á–∏';
}
</script>

<script>
function loadZonesStats() {
  fetch('/api/admin/zones_stats.php')
    .then(r => {
      if (!r.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
      return r.json();
    })
    .then(stats => {
      document.getElementById('totalZones').textContent = stats.–≤—Å–µ–≥–æ_–∑–æ–Ω || stats.total_zones || 0;
      document.getElementById('pendingZones').textContent = stats.–æ–∂–∏–¥–∞—é—Ç_–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è || stats.pending_zones || 0;
      document.getElementById('activeRedZones').textContent = stats.–∞–∫—Ç–∏–≤–Ω—ã–µ_–∫—Ä–∞—Å–Ω—ã–µ || stats.active_red_zones || 0;
      document.getElementById('activeYellowZones').textContent = stats.–∞–∫—Ç–∏–≤–Ω—ã–µ_–∂–µ–ª—Ç—ã–µ || stats.active_yellow_zones || 0;
      document.getElementById('expiredGreenZones').textContent = stats.–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ_–∑–µ–ª–µ–Ω—ã–µ || stats.expired_green_zones || 0;
    })
    .catch(err => {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–æ–Ω:', err);
    });
}

function loadZones() {
  fetch('/api/admin/zones.php')
    .then(r => {
      if (!r.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
      return r.json();
    })
    .then(zones => {
      const tbody = document.getElementById('zones');
      
      if (!zones || zones.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="empty-state">
              üì≠ –ù–µ—Ç –∑–æ–Ω —Ä–µ–º–æ–Ω—Ç–∞
            </td>
          </tr>
        `;
        return;
      }

      let html = '';
      zones.forEach(z => {
        let statusClass = '';
        let statusText = '';
        let statusColor = '';

        if (!z.is_active) {
          statusClass = 'status-deleted';
          statusText = '–£–¥–∞–ª–µ–Ω–∞';
        } else if (z.confirm_count === 0 && new Date(z.created_at) >= new Date(Date.now() - 24*60*60*1000)) {
          statusClass = 'status-pending';
          statusText = '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
          statusColor = 'pending';
        } else if (z.confirm_count > 0 && new Date(z.created_at) >= new Date(Date.now() - 7*24*60*60*1000)) {
          statusClass = 'status-active-red';
          statusText = '–ê–∫—Ç–∏–≤–Ω–∞—è –∫—Ä–∞—Å–Ω–∞—è';
          statusColor = 'active-red';
        } else if (z.confirm_count > 0 && new Date(z.created_at) >= new Date(Date.now() - 14*24*60*60*1000)) {
          statusClass = 'status-active-yellow';
          statusText = '–ê–∫—Ç–∏–≤–Ω–∞—è –∂–µ–ª—Ç–∞—è';
          statusColor = 'active-yellow';
        } else if (z.confirm_count > 0 && z.last_confirmed_at && new Date(z.last_confirmed_at) >= new Date(Date.now() - 24*60*60*1000)) {
          statusClass = 'status-expired-green';
          statusText = '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–µ–ª–µ–Ω–∞—è';
          statusColor = 'expired-green';
        } else {
          statusClass = 'status-deleted';
          statusText = '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞';
        }
        
        html += `
          <tr>
            <td><strong>#${z.id}</strong></td>
            <td>${z.description || '‚Äî'}</td>
            <td>
              ${z.creator_id ? `
                <a href="/profile.html?user=${z.creator_id}" style="color: #2196F3;">
                  ${z.nickname || z.email || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${z.creator_id}`}
                </a>
              ` : '‚Äî'}
            </td>
            <td>${new Date(z.created_at).toLocaleDateString('ru-RU')} ${new Date(z.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</td>
            <td><strong>${z.confirm_count}</strong></td>
            <td>${z.last_confirmed_at ? new Date(z.last_confirmed_at).toLocaleDateString('ru-RU') + ' ' + new Date(z.last_confirmed_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}) : '‚Äî'}</td>
            <td>
              <span class="status-badge ${statusClass}" title="${statusColor}">
                ${statusText}
              </span>
            </td>
            <td>
              <div class="table-actions">
                <a href="/index.html?zone=${z.id}" class="btn-view" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ">
                  üëÅ –ü–æ–∫–∞–∑–∞—Ç—å
                </a>
                ${z.is_active ? `
                  <button onclick="deleteZone(${z.id})" class="btn-delete" title="–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                  </button>
                ` : ''}
              </div>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    })
    .catch(err => {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–æ–Ω:', err);
      const tbody = document.getElementById('zones');
      tbody.innerHTML = `
        <tr>
          <td colspan="8" style="text-align: center; color: #C53030; padding: 40px;">
            ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
          </td>
        </tr>
      `;
    });
}

function deleteZone(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É?')) return;

  fetch('/api/admin/zones.php?id=' + id, {
    method: 'DELETE'
  })
  .then(() => {
    alert('–ó–æ–Ω–∞ —É–¥–∞–ª–µ–Ω–∞');
    loadZonesStats();
    loadZones();
  })
  .catch(err => {
    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + err.message);
  });
}

document.addEventListener('DOMContentLoaded', function() {
  loadZonesStats();
  loadZones();

  setInterval(function() {
    loadZonesStats();
    loadZones();
  }, 30000);
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function showLandingCard() {
        window.location.href = '/index.html';
    }

    const logos = document.querySelectorAll('.logo, .admin-page-header .logo');
    logos.forEach(logo => {
        logo.style.cursor = 'pointer';
        logo.title = '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é';
        logo.addEventListener('click', function(e) {
            e.preventDefault();
            showLandingCard();
        });
    });

    setTimeout(() => {
        const logos = document.querySelectorAll('.logo, .admin-page-header .logo');
        logos.forEach(logo => {
            if (!logo.hasAttribute('data-click-bound')) {
                logo.style.cursor = 'pointer';
                logo.title = '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é';
                logo.setAttribute('data-click-bound', 'true');
                logo.addEventListener('click', function(e) {
                    e.preventDefault();
                    showLandingCard();
                });
            }
        });
    }, 1000);
});
</script>

<script>
let allZones = [];
let currentFilter = 'all';

function getZoneStatus(z) {
    if (!z.is_active) {
        return 'deleted';
    } else if (z.confirm_count === 0 && new Date(z.created_at) >= new Date(Date.now() - 24*60*60*1000)) {
        return 'pending';
    } else if (z.confirm_count > 0 && new Date(z.created_at) >= new Date(Date.now() - 7*24*60*60*1000)) {
        return 'active-red';
    } else if (z.confirm_count > 0 && new Date(z.created_at) >= new Date(Date.now() - 14*24*60*60*1000)) {
        return 'active-yellow';
    } else if (z.confirm_count > 0 && z.last_confirmed_at && new Date(z.last_confirmed_at) >= new Date(Date.now() - 24*60*60*1000)) {
        return 'expired-green';
    } else {
        return 'deleted';
    }
}
function filterZones(filterType) {
    currentFilter = filterType;
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.filter-btn[onclick*="${filterType}"]`)?.classList.add('active');
    
    let filteredZones = [];
    
    switch(filterType) {
        case 'all':
            filteredZones = allZones;
            break;
            
        case 'pending':
            filteredZones = allZones.filter(z => getZoneStatus(z) === 'pending');
            break;
            
        case 'active-red':
            filteredZones = allZones.filter(z => getZoneStatus(z) === 'active-red');
            break;
            
        case 'active-yellow':
            filteredZones = allZones.filter(z => getZoneStatus(z) === 'active-yellow');
            break;
            
        case 'expired-green':
            filteredZones = allZones.filter(z => getZoneStatus(z) === 'expired-green');
            break;
            
        case 'deleted':
            filteredZones = allZones.filter(z => getZoneStatus(z) === 'deleted');
            break;
            
        default:
            filteredZones = allZones;
    }
    
    renderZonesTable(filteredZones);
}

function loadZones() {
    fetch('/api/admin/zones.php')
        .then(r => {
            if (!r.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            return r.json();
        })
        .then(zones => {
            allZones = zones;
            renderZonesTable(zones);
        })
        .catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–æ–Ω:', err);
            const tbody = document.getElementById('zones');
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; color: #C53030; padding: 40px;">
                        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                    </td>
                </tr>
            `;
        });
}
function renderZonesTable(zones) {
    const tbody = document.getElementById('zones');
    
    if (!zones || zones.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="8" class="empty-state">
                    üì≠ –ù–µ—Ç –∑–æ–Ω —Ä–µ–º–æ–Ω—Ç–∞
                </td>
            </tr>
        `;
        return;
    }

    let html = '';
    zones.forEach(z => {
        let statusClass = '';
        let statusText = '';
        const status = getZoneStatus(z);

        switch(status) {
            case 'deleted':
                statusClass = 'status-deleted';
                statusText = '–£–¥–∞–ª–µ–Ω–∞';
                break;
            case 'pending':
                statusClass = 'status-pending';
                statusText = '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
                break;
            case 'active-red':
                statusClass = 'status-active-red';
                statusText = '–ê–∫—Ç–∏–≤–Ω–∞—è –∫—Ä–∞—Å–Ω–∞—è';
                break;
            case 'active-yellow':
                statusClass = 'status-active-yellow';
                statusText = '–ê–∫—Ç–∏–≤–Ω–∞—è –∂–µ–ª—Ç–∞—è';
                break;
            case 'expired-green':
                statusClass = 'status-expired-green';
                statusText = '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–∞—è –∑–µ–ª–µ–Ω–∞—è';
                break;
            default:
                statusClass = 'status-deleted';
                statusText = '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞';
        }
        
        html += `
            <tr>
                <td><strong>#${z.id}</strong></td>
                <td>${z.description || '‚Äî'}</td>
                <td>
                    ${z.creator_id ? `
                        <a href="/profile.html?user=${z.creator_id}" style="color: #2196F3;">
                            ${z.nickname || z.email || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${z.creator_id}`}
                        </a>
                    ` : '‚Äî'}
                </td>
                <td>${new Date(z.created_at).toLocaleDateString('ru-RU')} ${new Date(z.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</td>
                <td><strong>${z.confirm_count}</strong></td>
                <td>${z.last_confirmed_at ? new Date(z.last_confirmed_at).toLocaleDateString('ru-RU') + ' ' + new Date(z.last_confirmed_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'}) : '‚Äî'}</td>
                <td>
                    <span class="status-badge ${statusClass}" title="${status}">
                        ${statusText}
                    </span>
                </td>
                <td>
                    <div class="table-actions">
                        <a href="/index.html?zone=${z.id}&tab=map" class="btn-view" title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ">
                            üëÅ –ü–æ–∫–∞–∑–∞—Ç—å
                        </a>
                        ${z.is_active ? `
                            <button onclick="deleteZone(${z.id})" class="btn-delete" title="–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        ` : ''}
                    </div>
                </td>
            </tr>
        `;
    });
    
    tbody.innerHTML = html;
}

document.addEventListener('DOMContentLoaded', function() {
    loadZonesStats();
    loadZones();
    document.querySelectorAll('.stat-card').forEach(card => {
        const type = Array.from(card.classList).find(cls => 
            ['total', 'pending', 'active-red', 'active-yellow', 'expired-green'].includes(cls)
        );
        if (type) {
            card.style.cursor = 'pointer';
            card.addEventListener('click', () => {
                if (type === 'total') {
                    filterZones('all');
                } else {
                    filterZones(type);
                }
            });
        }
    });
    setInterval(function() {
        loadZonesStats();
        loadZones();
        filterZones(currentFilter);
    }, 30000);
});
</script>

</body>
</html>